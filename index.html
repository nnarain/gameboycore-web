<html>
    <head>
        <title>GameboyCore JS Test</title>
    </head>
    <body>
        <input type='file' accept="text/plain" onchange="openFile(event)" />

        <script>
            var core = null;

            var Module = {
                onRuntimeInitialized: function() {
                    console.log('GameboyCore module initialized');

                    core = new Module.GameboyCore();
                }
            }
            var openFile = function(event) {
                var input = event.target;
                var reader = new FileReader();
                reader.onload = function(e) {
                    var buffer = reader.result;
                    var length = buffer.byteLength;

                    var ptr = Module._malloc(length);
                    Module.HEAPU8.set(new Uint8Array(buffer), ptr);

                    console.log("Loading GameboyCore with ROM file data");
                    console.log(core.loadROM(ptr, length));
                    Module._free(ptr);
                };

                console.log(input.files[0]);
                reader.readAsArrayBuffer(input.files[0]);
            }
        </script>
        <script src="/build/gameboycore-web.js"></script>
    </body>
</html>